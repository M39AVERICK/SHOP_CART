{% load static %} 
<!DOCTYPE html> 
<html lang="en"> 
<head>     
    <meta charset="UTF-8">     
    <meta name="viewport" content="width=device-width, initial-scale=1.0">     
    <title>ShopCart - Profile</title>      

    <!-- Favicons -->     
    <link href="{% static 'assets/img/favicon.png' %}" rel="icon">      

    <!-- Google Fonts -->     
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">      

    <!-- Bootstrap & Icons -->     
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">     
    <link href="{% static 'assets/vendor/bootstrap-icons/bootstrap-icons.css' %}" rel="stylesheet">          

    <!-- Custom CSS -->     
    <link href="{% static 'assets/css/main.css' %}" rel="stylesheet">      
    <style>         
        body { font-family: 'Poppins', sans-serif; background-color: #f4f4f4; }
        .profile-container { background: #fff; border-radius: 12px; padding: 30px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); }
        .profile-image { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid #007bff; }
        .order-table, .wallet-section { background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); }
    </style> 
</head>  

<body>  
    {% for message in messages %}
            <div class="alert alert-{{message.tags}} alert-dismissible fade show" role="alert">
                <strong>{{message}}</strong> 
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
    {% endfor %}

<header class="header bg-primary text-white py-3">     
    <div class="container d-flex justify-content-between align-items-center">         
        <h2>ShopCart</h2>         
        <nav>             
            <a href="{% url 'index' %}" class="text-white mx-3">Home</a>             
            {% if request.user.is_authenticated %}                 
            <a href="{% url 'logout' %}" class="btn btn-success text-white">Logout ({{ user.first_name }})</a>
          
            {% else %}                 
                <a href="{% url 'login' %}" class="btn btn-light">Login</a>                 
                <a href="{% url 'signup' %}" class="btn btn-outline-light">Sign Up</a>             
            {% endif %}         
        </nav>     
    </div> 
</header>  

<div class="container mt-5">     
    <div class="row">         
        <!-- Profile Card -->         
        <div class="col-md-4">             
            <div class="profile-container text-center">                 
                <img src="https://ui-avatars.com/api/?name={{ name }}&background=random&size=100" alt="User Avatar" class="profile-image">                 
                <h3 class="mt-3">Welcome, {{ user.first_name }}</h3>                 
                <button class="btn btn-primary mt-2" data-bs-toggle="modal" data-bs-target="#editProfileModal">Edit Profile</button> 
                <button class="btn btn-danger mt-2 mx-1" data-bs-toggle="modal" data-bs-target="#deleteprofile">
                    Delete Account
                </button>          </div>         
        </div>          

        <!-- Order & Wallet Section -->         
        <div class="col-md-8">             
            <div class="order-table mb-3">                 
                <h4 class="text-dark">User Profile</h4>                 
                <button class="btn btn-primary w-100" type="button" data-bs-toggle="collapse" data-bs-target="#orderDetails">All Orders</button>                 
                <div class="collapse mt-3" id="orderDetails">                     
                    <table class="table table-bordered">                         
                        <thead>                             
                            <tr>                                 
                                <th>Order ID</th>                                 
                                <th>Customer</th>                                 
                                <th>Products</th>                                 
                                <th>Amount</th>                                 
                                <th>Payment Status</th>
                                <th>Shipment Date</th>
                                <th>Tracking</th>                                                              
                            </tr>                         
                        </thead>                         
                        <tbody>                             
                            {% for order in orders %}                                 
                            <tr>                                      
                                <td>#{{ order.order_id }}</td>                                          
                                <td>{{ order.name }}</td>                                     
                                <td>                                         
                                    {% for key, value in order.items.items %}                                              
                                        <strong>{{ value.name }}</strong> (Qty: {{ value.qty }})<br>                                         
                                    {% endfor %}                                     
                                </td>                                     
                                <td>₹{{ order.amount }}</td>                                     
                                <td>{{ order.payment_status }}</td>      
                                <td>{{ order.shipment_date|date:"d M Y, h:i A" }}</td>    
                                <td>
                                    {% if order.tracking_id %}
                                        <a href="{{ order.tracking_url }}" class="btn btn-sm btn-info" target="_blank">
                                            Track Order <i class="bi bi-truck"></i>
                                        </a>
                                    {% else %}
                                        <span class="text-danger">Not Available</span>
                                    {% endif %}
                                </td>                             
                            </tr>                             
                            {% empty %}                                 
                            <tr>                                     
                                <td colspan="5" class="text-center text-danger">No orders found.</td>                                 
                            </tr>                             
                            {% endfor %}                         
                        </tbody>                     
                    </table>                 
                </div>             
            </div> 

            <!-- Wallet Section -->             
            <div class="wallet-section p-3">                 
                <h4>Wallet Balance: ₹{{ user.wallet_balance }}</h4>                 
                <button class="btn btn-success">Add Money</button>             
            </div>         
        </div>     
    </div> 
</div>  
<!-- Delete Profile Modal -->
<div class="modal" id="deleteprofile" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Delete Account</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete your account?</p>
                <button class="btn btn-danger mx-1">Sure</button>
                <button class="btn btn-secondary mx-1" data-bs-dismiss="modal">Not Sure</button>
            </div>
        </div>
    </div>
</div><!-- Edit Profile Modal -->
<div class="modal fade" id="editProfileModal" tabindex="-1">     
    <div class="modal-dialog">         
        <div class="modal-content">             
            <div class="modal-header">                 
                <h5 class="modal-title">Edit Profile</h5>       
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>             
            </div>             
            <div class="modal-body">                 
                <form method="POST">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label>Name</label>
                        <input type="text" class="form-control" name="name" value="{{ user.first_name }}">
                    </div>
                    <div class="mb-3">
                        <label>Delivery Address</label>
                        <input type="text" class="form-control" name="address" value="{{ orders.0.address }}">
                    </div>
                    <div class="mb-3">
                        <label for="Email">Email</label>
                        <input type="email" class="form-control" name="email" value="{{email}}">
                    </div>
                    <div class="mb-3">
                        <label for="Phone">Phone No</label>
                        <input type="number" class="form-control" name="phone" value="{{phone}}">
                        
                    </div>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </form>
                
                             
            </div>         
        </div>     
    </div> 
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script> 
<script>
    function toggleDarkMode() { document.body.classList.toggle('bg-dark'); document.body.classList.toggle('text-white'); }
    
    function fetchTracking(orderId) {
        fetch(`/track-order/${orderId}/`)
        .then(response => response.json())
        .then(data => {
            if (data.tracking_url) {
                window.open(data.tracking_url, '_blank');
            } else {
                alert("Tracking details not available yet.");
            }
        })
        .catch(error => console.error("Error fetching tracking details:", error));
    }
</script>


</body> 
</html>